@model PagedList.IPagedList<TLAS.Models.Shipment>
@using PagedList.Mvc;
@using Microsoft.AspNet.Identity;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
@{
    ViewBag.Title = "Shipment";
}
<hr />
<div class="container">
    <div class="col-md-4">
        <h2>Shipment</h2>
        <div class="table-responsive">
            @using (Html.BeginForm("Index", "Shipments", FormMethod.Get))
            {
                <p>
                    <div class="form-horizontal">
                        <div class="form-group">
                            <div class="col-md-6">
                                @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, new { @class = "form-control", @title = "Search By Vehicle Code", @placeholder = "Vehicle Code" })
                            </div>
                            <div class="col-md-1" style="margin-left:-23px;">
                                <input type="submit" value="Search" class="btn btn-primary" />
                            </div>
                        </div>

                    </div>

                </p>
            }
            <table class="table table-condensed table-bordered table-hover table-striped">
                <thead>
                    <tr class="btn-default">
                        <th><b>@Html.ActionLink("Vehicle Code", "Index", new { sortOrder = ViewBag.IdSortParm })</b></th>
                        <th><b>@Html.ActionLink("Order Code", "Index", new { sortOrder = ViewBag.NameSortParm })</b></th>
                        <th><b>@Html.ActionLink("Status", "Index")</b></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        string shipmentdate = null;
                        try
                        {
                            if (item.ShipmentDate != null)
                        {
                            shipmentdate = item.ShipmentDate.Value.ToShortDateString();
                        }
                        }
                        catch (Exception)
                        {
                            shipmentdate = null;
                        }
                        <tr onclick="edit('@item.ID','@item.IsManual','@item.AccessCardID','@item.ModifiedDate','@item.DeletedFlag','@item.CreatedDate','@item.ShipmentStatusID','@item.OrderID','@item.BayID','@item.BayName','@item.CustomerName','@item.VehicleCode','@item.DriverName','@item.DriverCNIC','@item.CarrierName','@shipmentdate','@item.ProductID','@item.VehicleCode','@item.Order.OrderQty','@item.Order.OrderCode');">
                            <td>
                                @Html.DisplayFor(modelItem => item.VehicleCode)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Order.OrderCode)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ShipmentStatu.Status)
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
            <br />
            Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
            @Html.PagedListPager(Model, page => Url.Action("Index", new { page, sortOrder = ViewBag.CurrentSort, currentFilter = ViewBag.CurrentFilter }))
        </div>
    </div>



        @using (Html.BeginForm("Create", "Shipments", FormMethod.Post, new { @id = "formAll" }))
        {
        <div class="col-md-8">
            @Html.ValidationSummary(true, "", new { @class = "text-danger", @id = "errorSummary" })
            @Html.Label(" ", new { @id = "errorMessagesOnSave", Style = "color: red" })
            <div class="form-group ">
                <div class="btn-group col-md-offset-4">
                    <button type="submit" class="btn btn-primary" id="save" disabled>Save</button>
                    <button type="submit" class="btn btn-primary" id="close" onclick="closePressed();" disabled >Close</button>
                    <button type="button" class="btn btn-primary" id="loadSlip" onclick="loadSlipPressed();" data-toggle="modal" data-target=".bootstrapmodal" disabled>Print LoadSlip</button>
                    <button type="button" class="btn btn-primary" id="bol" onclick="BoLPressed();" data-toggle="modal" data-target=".bootstrapmodal1" disabled>Print BoL</button>
                </div>
            </div>
            <div class="form-horizontal">
                @Html.HiddenFor(m => Model.FirstOrDefault().ModifiedDate, new { @Value = System.DateTime.Now })
                @*@Html.HiddenFor(m => Model.FirstOrDefault().CreatedDate, new { @Value = System.DateTime.Now })*@
                @Html.HiddenFor(m => Model.FirstOrDefault().ID, new { @id = "shipmentId" })
                @Html.HiddenFor(m => Model.FirstOrDefault().ShipmentStatusID, new { @id = "shipmentStatusId" })
                @Html.HiddenFor(m => Model.FirstOrDefault().ProductID, new { @id = "productId" })
                @Html.HiddenFor(m => Model.FirstOrDefault().Order.OrderQty, new { @id = "odrQty" })
                @Html.HiddenFor(m => Model.FirstOrDefault().OrderID, new { @id = "odrId" })
                @Html.HiddenFor(m => Model.FirstOrDefault().DriverCNIC, new { @id = "drvCNIC" })
                <div class="form-group">
                    <label for="custName" class="col-md-4 control-label">Customer Name</label>
                    <div class="col-md-4">
                        @Html.EditorFor(m => Model.FirstOrDefault().CustomerName, new { htmlAttributes = new { @class = "form-control", @id = "custName", @readonly = "readonly" } })
                    </div>
                </div>
                <div class="form-group">
                    <label for="carrName" class="col-md-4 control-label">Carrier Name</label>
                    <div class="col-md-4">
                        @Html.EditorFor(m => Model.FirstOrDefault().CarrierName, new { htmlAttributes = new { @class = "form-control", @id = "carrName", @readonly = "readonly" } })
                    </div>
                </div>
                <div class="form-group">
                    <label for="custName" class="col-md-4 control-label">Vehicle Code</label>
                    <div class="col-md-4">
                        @Html.EditorFor(m => Model.FirstOrDefault().VehicleCode, new { htmlAttributes = new { @class = "form-control", @id = "vehCode", @readonly = "readonly" } })
                    </div>
                </div>
                <div class="form-group">
                    <label for="custName" class="col-md-4 control-label">Driver Name</label>
                    <div class="col-md-4">
                        @Html.EditorFor(m => Model.FirstOrDefault().DriverName, new { htmlAttributes = new { @class = "form-control", @id = "drvName", @readonly = "readonly" } })
                    </div>
                </div>
                <div class="form-group">
                    <label for="licDate" class="col-md-4 control-label">Date of Shipment</label>
                    <div class="col-md-4">
                        @{
                            string shipmentdatereuse = null;
                            try
                            {
                                if(Model.FirstOrDefault().ShipmentDate != null)
                            {
                                shipmentdatereuse = Convert.ToString(Model.FirstOrDefault().ShipmentDate.Value.ToShortDateString());
                            }
                            }
                            catch(Exception)
                            {
                                shipmentdatereuse = null;
                            }
                            
                        }
                        @Html.EditorFor(m => Model.FirstOrDefault().ShipmentDate, new { htmlAttributes = new { @class = "form-control", @id = "dateShipment", @Value = shipmentdatereuse } })
                        @*@Html.ValidationMessageFor(m => Model.FirstOrDefault().ShipmentDate, "", new { @class = "text-danger" })*@
                    </div>
                </div>
                <div class="form-group">
                    <label for="compSelect" class="col-md-4 control-label">Bay No</label>
                    <div class="col-md-4">
                        @Html.DropDownListFor(m => Model.FirstOrDefault().BayID, ViewData["BayID"] as SelectList, new { @class = "form-control", @id = "bayName" })
                        @*@Html.ValidationMessageFor(m => Model.FirstOrDefault().BayID, "", new { @class = "text-danger" })*@
                    </div>
                </div>
                <div class="form-group">
                    <label for="compSelect" class="col-md-4 control-label">RFID Card No</label>
                    <div class="col-md-4">
                        @Html.DropDownListFor(m => Model.FirstOrDefault().AccessCardID, ViewData["AccessCardID"] as SelectList, new { @class = "form-control", @id = "cardNo" })
                        @*@Html.ValidationMessageFor(m => Model.FirstOrDefault().AccessCardID, "", new { @class = "text-danger" })*@
                    </div>
                </div>
                <div class="form-group">
                    <label for="" class="col-md-4 control-label">Manual Entry</label>
                    <div class="col-md-4">
                @if (Request.IsAuthenticated && User.IsInRole("Admin") || User.IsInRole("Supervisor"))
                {
                   @Html.CheckBoxFor(m => Model.FirstOrDefault().IsManual, new { @id = "manualEntry", htmlAttributes = new { @class = "form-control" } })
                }
                else
                {
                   @Html.CheckBoxFor(m => Model.FirstOrDefault().IsManual, new { @id = "manualEntry", @disabled = "disabled", htmlAttributes = new { @class = "form-control" } })
                }
                    </div>
                </div>
            </div>

            
        </div>

    <div class="container">
        <div class="col-md-11">
            <h2>Compartment</h2>
            <div class="table-responsive">
                <table class="table table-condensed table-bordered table-hover table-striped">
                    <thead>
                        <tr class="btn-primary">
                            <th><b>Compartment Code</b></th>
                            <th><b>Order Code</b></th>
                            <th><b>Product</b></th>
                            <th><b>Ordered Qty</b></th>
                            <th><b>Capacity</b></th>
                            <th><b>Planned Qty</b></th>
                            <th><b>Actual Qty</b></th>

                        </tr>
                    </thead>
                    <tbody id="compTable">

                        @*<tr>
                        <td><span></span></td>
                        <td><span></span></td>
                        <td><span></span></td>
                    </tr>*@


                    </tbody>
                </table>
            </div>
        </div>
        </div>

        }
</div>


<div class="modal fade bootstrapmodal" id="printLoadingSlip">
    <div class="modal-dialog">
        <div class="modal-content LoadingSlip-content" id="printLoadingSlip" style="background-image:url(../../Content/Images/LoadSlip.png);z-index:-99999; background-repeat:no-repeat; width: 740px;-webkit-print-color-adjust: exact; ">

            <div class="modal-body" style="height: 447px;">

                <table style="width:700px; margin-top:90px;">
                    <tbody>
                        <tr>
                            <td colspan="2" style="text-align:right; padding-right:8px;">
                                <label class="control-label" id="lbl_LSDate" style="font-size: 13px;"></label>
                            </td>
                        </tr>
                        <tr style="
    /* padding-top: 10PX; */
    /* VERTICAL-ALIGN: MIDDLE; */
">
                            <td style="width: 342px;text-indent: 69px;vertical-align: bottom;padding-top: 5px;">
                                <label class="control-label" id="lbl_Ship" style="font-size: 13px;"></label>
                            </td>
                            <td style="
    padding-top: 7px;
">
                                <label class="control-label" id="lbl_Cust" style="font-size: 13px; vertical-align: top; padding-left:120px;"></label>
                            </td>

                        </tr>
                        <tr>
                            <td style="padding-left: 139px;padding-top: 7px;">
                                <label class="control-label" id="lbl_Drvr" style="font-size: 13px;"></label>
                            </td>
                            <td style="padding-top: 7px;padding-left: 120px;">
                                <label class="control-label" id="lbl_RFID" style="font-size: 13px;"></label>
                            </td>

                        </tr>

                        <tr>
                            <td style="padding-top: 7px;padding-left: 139px;">
                                <label class="control-label" id="lbl_Vno" style="font-size: 13px;"></label>
                            </td>
                            <td style="padding-top: 7px;padding-left: 132px;">
                                <label class="control-label" id="lbl_CretedDte" style="font-size: 13px;">@User.Identity.GetUserName()</label>
                            </td>

                        </tr>


                        <tr>
                            <td colspan="2" style=" padding-top: 41px; padding-left: 15px;">
                                <table width="100%">
                                    <tbody>
                                        <tr>
                                            <td style="width:170px;">
                                                <label class="control-label" id="lbl_Ocode" style="font-size: 13px;"></label>
                                            </td>
                                            <td style="width:170px;">
                                                <label class="control-label" id="lbl_Prod" style="font-size: 13px;"></label>
                                            </td>
                                            <td style="width:170px;">
                                                <label class="control-label" id="lbl_Qty" style="font-size: 13px;"></label>
                                            </td>
                                            <td style="width:170px;">
                                                <label class="control-label" id="lbl_Bay" style="font-size: 13px;"></label>
                                            </td>

                                        </tr>

                                    </tbody>
                                </table>
                            </td>
                        </tr>


                        <tr>

                            <td colspan="2" style="padding-top:29px;">
                                <table width="100%">
                                    <tbody>
                                        <tr>
                                            <td style="
    /* padding-left: 72px; */
    width: 169px;
    padding-left: 85px;
">
                                                <label class="control-label" id="lbl_Comp1"></label>
                                            </td>
                                            <td style="
    width: 170px;
    padding-left: 88px;
">
                                                <label class="control-label" id="lbl_Comp2"></label>
                                            </td>
                                            <td style="
    width: 171px;
    padding-left: 89px;
">
                                                <label class="control-label" id="lbl_Comp3"></label>
                                            </td>
                                            <td style="
    padding-left: 89px;
">
                                                <label class="control-label" id="lbl_Comp4"></label>
                                            </td>

                                        </tr>
                                        <tr>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty1" style="
    padding-left: 85px;
    padding-top: -5px;
    margin-top: -10px;
    position: relative;
    top: -7px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty2" style="
    padding-left: 88px;
    position: relative;
    top: -7px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty3" style="
    padding-left: 88px;
    position: relative;
    top: -7px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty4" style="
    position: relative;
    top: -7px;
    padding-left: 88px;
"></label>
                                            </td>

                                        </tr>

                                        <tr>
                                            <td>
                                                <label class="control-label" id="lbl_Comp5" style="
    position: relative;
    top: -16px;
    padding-left: 85px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_Comp6" style="
    position: relative;
    top: -16px;
    padding-left: 88px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_Comp7" style="
    position: relative;
    top: -16px;
    padding-left: 88px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_Comp8" style="
    position: relative;
    top: -16px;
    padding-left: 88px;
"></label>
                                            </td>

                                        </tr>
                                        <tr>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty5" style="
    position: relative;
    top: -23px;
    padding-left: 85px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty6" style="
    position: relative;
    top: -23px;
    padding-left: 88px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty7" style="
    position: relative;
    top: -23px;
    padding-left: 88px;
"></label>
                                            </td>
                                            <td>
                                                <label class="control-label" id="lbl_CompPQty8" style="
    position: relative;
    top: -23px;
    padding-left: 88px;
"></label>
                                            </td>

                                        </tr>


                                    </tbody>
                                </table>


                            </td>
                        </tr>



                    </tbody>
                </table>

            </div>

            <div class="modal-footer hidden-print" style="border:none;">

                <button class="btn btn-primary" onclick="window.print();"> Print </button>
                <button class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>

</div>










<div class="modal fade bootstrapmodal1" id="printBOL">
    <div class="modal-dialog">
        <div class="modal-content BOL-content" id="printBOL" style="background-image:url(../../Content/Images/Bol.png); z-index:-99999; background-repeat:no-repeat; width: 760px;-webkit-print-color-adjust: exact; ">

            <div class="modal-body" style="height: 447px;">

                <label class="control-label" id="lbl_BolDate" style="position: absolute;top: 110px;/* left: 185px; */font-size: 13px;right: 21px;"></label>

                <label class="control-label" id="lbl_Vehbol" style="position: absolute;top: 139px;left: 110px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_Shipbol" style="position: absolute;top: 139px;left: 367px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_Custbol" style="position: absolute;top: 139px;left: 555px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_DDatebol" style="position: absolute;top: 173px;left: 110px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_EntTmebol" style="position: absolute;top: 173px;left: 327px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_ExtTimebol" style="position: absolute;top: 173px;left: 556px;font-size: 13px;"></label>


                <label class="control-label" id="lbl_OdrCdebol" style="position: absolute;top: 258px;left: 30px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_prodbol" style="position: absolute;top: 258px;left: 140px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_Qtybol" style="position: absolute;top: 258px;left: 265px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_PlnQtybol" style="position: absolute;top: 258px;left: 380px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_ActQtybol" style="position: absolute;top: 258px;left: 497px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol1" style="position: absolute;top: 311px;left: 100px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol1" style="position: absolute;top: 332px;left: 100px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol1" style="position: absolute;top: 351px;left: 100px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol2" style="position: absolute;top: 312px;left: 272px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol2" style="position: absolute;top: 332px;left: 272px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol2" style="position: absolute;top: 351px;left: 272px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol3" style="position: absolute;top: 312px;left: 452px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol3" style="position: absolute;top: 333px;left: 452px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol3" style="position: absolute;top: 351px;left: 453px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol4" style="position: absolute;top: 312px;right: 124px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol4" style="position: absolute;top: 333px;left: 627px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol4" style="position: absolute;top: 351px;left: 628px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol5" style="position: absolute;top: 380px;left: 102px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol5" style="position: absolute;top: 401px;left: 102px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol5" style="position: absolute;top: 422px;left: 101px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol6" style="position: absolute;top: 380px;left: 274px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol6" style="position: absolute;top: 401px;left: 274px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol6" style="position: absolute;top: 422px;left: 274px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol7" style="position: absolute;top: 380px;left: 452px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol7" style="position: absolute;top: 401px;left: 452px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol7" style="position: absolute;top: 422px;left: 452px;font-size: 13px;"></label>

                <label class="control-label" id="lbl_Compidbol8" style="position: absolute;top: 380px;left: 627px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CPlnQtybol8" style="position: absolute;top: 401px;left: 627px;font-size: 13px;"></label>
                <label class="control-label" id="lbl_CActQtybol8" style="position: absolute;top: 422px;left: 627px;font-size: 13px;"></label>



            </div>

            <div class="modal-footer hidden-print" style="border:none;">

                <button class="btn btn-primary" onclick="window.print();"> Print </button>
                <button class="btn btn-default" data-dismiss="modal">cancel</button>
            </div>
        </div>


    </div>
</div>



@section Scripts {
    @*@Scripts.Render("~/bundles/jquery")*@
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/cssjqryUi")
}
<style type="text/css" media="print">
    body * {
        visibility: hidden;
    }

    #printLoadingSlip, #printLoadingSlip * {
        visibility: visible;
    }


    #printBOL, #printBOL * {
        visibility: visible;
    }

    .BOL-content:before {
        content: url(images/Bol.png);
        background-repeat: no-repeat;
        z-index: -99999;
        width: 740px;
        z-index: -99999;
        position: absolute;
        top: 0px;
        left: 0px;
    }

    .LoadingSlip-content:before {
        content: url(Images/LoadSlip.png);
        background-repeat: no-repeat;
        z-index: -99999;
        width: 740px;
        z-index: -99999;
        position: absolute;
        top: 0px;
        left: 0px;
    }



    #lbl_Ship {
        padding-top: -1px;
    }
</style>
<style type="text/css">
    td {
        border: 1px solid transparent;
    }
</style>

<script type="text/javascript">

    $(function () {


        $('#dateShipment').datepicker({
            dateFormat: 'mm/dd/yy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-15:+15"
        });
        $('#custName').val("")
        $('#vehCode').val("")
        $('#drvName').val("")
        $('#dateShipment').val("")
        $('#carrName').val("")
        //////////////////////////////////////////////////////Custom Validation/////////////////////////////////////////////////////////////

        $('#formAll').validate({
            errorClass: "text-danger",
            debug: true,
            rules: {
                ShipmentDate: {
                    required: true,
                },
                AccessCardID: {
                    required: true,
                },
                BayID: {
                    required: true,
                }
            },
            messages: {
                ShipmentDate: {
                    required: "Shipment Date is required."
                },
                AccessCardID: {
                    required: "Access Card is required."
                },
                BayID: {
                    required: "Bay is required."
                }
            }
        });
        
        ///////////////////////////////////////////////////////submit ob click event/////////////////////////////////////////////////////////////////
        $(document).on('click', 'form button[type=submit]', function (e) {
            debugger;
            var isValid = $('#formAll').valid();
            if (!isValid) {
                e.preventDefault(); //prevent the default action
                return;
            }
            else if ($('#compTable tr').length == 0)
            {
                $("#errorMessagesOnSave").text("No Compartment found");
                e.preventDefault();
                return;
            }
            else if (e.target.id == "close")
            {
                for (var i = 0; i < $('#compTable tr').length; i++) {
                    var plannedQty = parseInt($('#compPlannedQty' + i).val())
                    var actualQty = parseInt($('#compActualQty' + i).val())
                    if (plannedQty != 0 && isNaN(actualQty)) {
                        $("#errorMessagesOnSave").text("Actual Quantity cannot be null, Check manual entry checkbox and correct the values");
                        e.preventDefault();
                        return;
                    }
                }
                $("#shipmentStatusId").val(5);
            }
            else if ($('#compTable tr').length > 0) {
                    for (var i = 0; i < $('#compTable tr').length; i++) {
                        $("#compPlannedQty" + i).rules("add", {
                            required:true,
                            digits: true,
                            messages: {
                                required : "Only digits allowed"
                            }
                        });
                    }
                    var newValid = $('#formAll').valid();
                        if (!newValid) {
                            e.preventDefault(); //prevent the default action
                            return;
                    }
                        else {
                            var sumOfPlannedQty = 0;
                            for (var i = 0; i < $('#compTable tr').length; i++) {
                                    sumOfPlannedQty = sumOfPlannedQty + parseInt($('#compPlannedQty' + i).val());
                                    if (parseInt($('#compPlannedQty' + i).val()) > parseInt($('#compCapacity' + i).val())) {
                                        $("#errorMessagesOnSave").text("Planned Quantity must not be greater than the compartment capacity");
                                        e.preventDefault();
                                        return;
                                }

                            }
                            if (sumOfPlannedQty != parseInt($('#odrQty').val())) {
                                $("#errorMessagesOnSave").text("Sum of Planned Quantity must be equal to the ordered Quantity");
                                e.preventDefault();
                                return;
                            }

                            $("#errorMessagesOnSave").text(" ");
                    }

            }
        });

        $("#formAll").submit(function (e) {
            if($("#errorMessagesOnSave").text() != " ")
            {
                e.preventDefault();
                return;
            }
            else {
                e.preventDefault(); //prevent default form submit

                $.ajax({
                    type: "post",
                    url: '@Url.Action("cardAssigned", "Shipments")',
                    data: { cardId: $("#cardNo").val() },
                    datatype: "json",
                    traditional: true
                }).done(function myfunction(data) {
                    try {
                        if (data == false) {
                            if ($("#manualEntry").is(":checked")) {
                                $("#shipmentStatusId").val(4);
                            }
                            $("#errorMessagesOnSave").text(" ");
                            $("#formAll").unbind('submit').submit();

                        }
                        else {
                            if (data == $("#shipmentId").val()) {
                                if ($("#manualEntry").is(":checked")) {
                                    $("#shipmentStatusId").val(4);
                                }
                                $("#errorMessagesOnSave").text(" ");
                                $("#formAll").unbind('submit').submit();
                            }
                            else {
                                $("#errorMessagesOnSave").text("Card Already in use");
                            }

                        }
                    }
                    catch (err) {
                        alert(err.message);
                    }

                })
            }
        });





        ////////////////////////////////////form submit//////////////////////////////////////////////////////
        $('#bayName').change(function () {
            $.ajax({
                type: "post",
                url: '@Url.Action("SelectCard", "Shipments")',
                data: { bayId: $("#bayName").val() },
                datatype: "json",
                traditional: true
            }).done(function myfunction(data) {
                $('#cardNo').empty();
                for (var i = 0; i < data.length; i++) {
                    $('#cardNo').append('<option value="' + data[i].Value + '">' + data[i].Text + '</option>');
                }
            })
        })

        //////////////////////////////////////////////////card number on change end/////////////////////////////////////////////////
        

    });
    function edit(id, isManual, accessCard, modifiedDate, DeletedFlag, createdDate, shipStatusId, orderId, bayId, bayName, customerName, vehicleCode, driverName, driverCnic, carrierName, shipmentDate, productId, vehicleId, odrQty, odrCode) {


        $("#errorMessagesOnSave").text(" ");

        //////////////////////////////////////////////////////////////////////bay///////////////////////////////////////////////////////////////////////////////////
        $.ajax({
            type: "post",
            url: '@Url.Action("SelectBay", "Shipments")',
            data: { prdId: productId },
            datatype: "json",
            traditional: true
        }).done(function myfunction(data) {
            $('#bayName').empty();
            for (var i = 0; i < data.length; i++) {
                $('#bayName').append('<option value="' + data[i].Value + '">' + data[i].Text + '</option>');
            }
            if (bayId != 0) {
                $("#bayName").val(bayId);
            }
            else {
                $("#bayName").val(data[0].Value);
                bayId = data[0].Value;
            }
            //////////////////////////////////////////////////////card///////////////////////////////////////////////////////////
            $.ajax({
                type: "post",
                url: '@Url.Action("SelectCard", "Shipments")',
                data: {
                    bayId: bayId
                },
                datatype: "json",
                traditional: true
            }).done(function myfunction(data) {
                $('#cardNo').empty();
                for (var i = 0; i < data.length; i++) {
                    $('#cardNo').append('<option value="' + data[i].Value + '">' + data[i].Text + '</option>');
                }
                $("#cardNo").val(accessCard);
            })
        })
        ////////////////////////////////////////////////////////////////////////end bay//////////////////////////////////////////////////////////////////////////////////////


        $("#shipmentId").val(id)

        $("#shipmentStatusId").val(shipStatusId)
        $("#productId").val(productId)
        $("#odrQty").val(odrQty)
        $("#odrId").val(orderId)
        $("#custName").val(customerName)
        $("#vehCode").val(vehicleCode)
        $("#drvName").val(driverName)
        $("#drvCNIC").val(driverCnic)
        $("#carrName").val(carrierName)

        $("#dateShipment").val(shipmentDate)

        if (isManual == "onclick") {
            $("#manualEntry").prop('checked', true);
        }
        else {
            $("#manualEntry").prop('checked', false);
        }





        var prd;
        if (productId == 1) {
            prd = "LPG"
        }
        else {
            prd = "Condensate"
        }
        $.ajax({
            type: "post",
            url: '@Url.Action("compartmentPlanning", "Shipments")',
            data: {
                vehicleId: vehicleId,
                id: id
            },
            datatype: "json",
            traditional: true
        }).done(function myfunction(data) {
            if (data == false)
            {
                $('#compTable').empty();
            }
            else {
                $('#compTable').empty();
                if (data[0].isCreatedLI == true) {
                    for (var i = 0; i < data.length; i++) {
                        $('#compTable').append('<tr class="item"><input type="hidden" class="form-control" name="compId' + i + '" id="compId' + i + '" value= "' + data[i].CompIdLI + '" readonly /><td><input type="text" class="form-control" name="compCode' + i + '" id="compCode' + i + '" value= "' + data[i].CompCodeLI + '" readonly /></td><td><input type="text" class="form-control" name="compOdrCode' + i + '" id="compOdrCode' + i + '" value= "' + odrCode + '" readonly /></td><td><input type="text" class="form-control" name="compPrd' + i + '" id="compPrd' + i + '" value= "' + prd + '" readonly /></td><td><input type="text" class="form-control" name="compOdrQty' + i + '" id="compOdrQty' + i + '" value= "' + data[i].OrderedQtyLI + '" readonly /></td><td><input type="text" class="form-control" name="compCapacity' + i + '" id="compCapacity' + i + '" value= "' + data[i].CapacityLI + '" readonly /></td><td><input type="number" class="form-control" name="compPlannedQty' + i + '" id="compPlannedQty' + i + '" value= "' + data[i].PlannedQtyLI + '" /></td><td><input type="text" class="form-control" name="compActualQty' + i + '" id="compActualQty' + i + '" value= "' + data[i].ActualQtyLI + '" readonly /></td></tr>');
                    }
                }
                else {
                    for (var i = 0; i < data.length; i++) {
                        $('#compTable').append('<tr class="item"><td><input type="text" class="form-control" name="compCode' + i + '" id="compCode' + i + '" value= "' + data[i].Text + '" readonly /></td><td><input type="text" class="form-control" name="compOdrCode' + i + '" id="compOdrCode' + i + '" value= "' + odrCode + '" readonly /></td><td><input type="text" class="form-control" name="compPrd' + i + '" id="compPrd' + i + '" value= "' + prd + '" readonly /></td><td><input type="text" class="form-control" name="compOdrQty' + i + '" id="compOdrQty' + i + '" value= "' + odrQty + '" readonly /></td><td><input type="text" class="form-control" name="compCapacity' + i + '" id="compCapacity' + i + '" value= "' + data[i].Value + '" readonly /></td><td><input type="number" class="form-control" name="compPlannedQty' + i + '" id="compPlannedQty' + i + '" /></td><td><input type="text" class="form-control" name="compActualQty' + i + '" id="compActualQty' + i + '" value= "' + 0 + '" readonly /></td></tr>');
                    }
                }
            }
            
        })

        /////////////////////////////////finally unlock and lock buttons////////////////////////////////////////////
        switch (shipStatusId) {
            case "1":
                $("#save").prop("disabled", false);
                $("#loadSlip").prop("disabled", true);
                $("#close").prop("disabled", true);
                $("#bol").prop("disabled", true);
                break;
            case "2":
                $("#save").prop("disabled", false);
                $("#loadSlip").prop("disabled", false);
                $("#close").prop("disabled", true);
                $("#bol").prop("disabled", true);

                break;
            case "3":
                $("#save").prop("disabled", false);
                $("#loadSlip").prop("disabled", false);
                $("#close").prop("disabled", false);
                $("#bol").prop("disabled", true);
                break;
            case "4":
                $("#save").prop("disabled", true);
                $("#loadSlip").prop("disabled", true);
                $("#close").prop("disabled", true);
                $("#bol").prop("disabled", true);
                break;
            case "5":
                $("#save").prop("disabled", true);
                $("#loadSlip").prop("disabled", true);
                $("#close").prop("disabled", true);
                $("#bol").prop("disabled", false);
                break;

        }
        if (isManual == "onclick" && shipStatusId != 5) {
            $("#save").prop("disabled", true);
            $("#loadSlip").prop("disabled", true);
            $("#close").prop("disabled", true);
            $("#bol").prop("disabled", false);
        }


        //////////////////////////////////////////////print slips //////////////////////////////////////////////////////////////////////////////////////////////////

        

        var date = new Date();
        date = date.toLocaleString('en-US');

        var shipdate = id + "(" + date + ")";

        $("#lbl_Ship").text(shipdate);
        $("#lbl_Cust").text(customerName);
        $("#lbl_Drvr").text(driverName);
        $("#lbl_RFID").text(accessCard);
        $("#lbl_Vno").text(vehicleCode);
        $("#lbl_Ocode").text(odrCode);
        $("#lbl_Prod").text(prd);
        $("#lbl_Qty").text(odrQty);
        $("#lbl_Bay").text(bayId);
        //////////////////////////////////////
        $("#lbl_Ship1").text(shipmentDate);
        $("#lbl_Cust1").text(customerName);
        $("#lbl_Drvr1").text(driverName);
        ////////////////////////////////////
        
        ////////////////////////////////////////////////BoL Slip////////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////
        $("#lbl_Shipbol").text(id);
        $("#lbl_Custbol").text(customerName);
        $("#lbl_Vehbol").text(vehicleCode);
        ////////////////////////////////////
        //////////////////////////////////////
        $("#lbl_DDatebol").text(shipmentDate);
        $("#lbl_EntTmebol").text(createdDate);
        $("#lbl_ExtTimebol").text(modifiedDate);
        ////////////////////////////////////
        $("#lbl_OdrCdebol").text(odrCode);
        $("#lbl_prodbol").text(prd);
        $("#lbl_Qtybol").text(odrQty);
        ////////////////////////////////////

        




    }
    function  BoLPressed() {

        for (k = 1; k < 9; k++) {
            $('#lbl_Compidbol' + k).text(" ");
            $('#lbl_CActQtybol' + k).text(" ");
            $('#lbl_CPlnQtybol' + k).text(" ");
        }
        var countTr = $('#compTable tr').length;
        var j = 0;
        var sumOfPlannedQty = 0;
        var sumOfActualQty = 0;
        for (var i = 0; i < countTr; i++) {
            
            
            if ($.isNumeric(parseInt($('#compPlannedQty' + i).val()))) {
                sumOfActualQty = sumOfActualQty + parseInt($('#compActualQty' + i).val());
                sumOfPlannedQty = sumOfPlannedQty + parseInt($('#compPlannedQty' + i).val());
                j++;
                $('#lbl_Compidbol' + j).text(parseInt($('#compCode' + i).val()))
                $('#lbl_CActQtybol' + j).text(parseInt($('#compActualQty' + i).val()))
                
                //$('#lbl_Comp' + j).text(parseInt($('#compCode' + i).val()))
                $('#lbl_CPlnQtybol' + j).text(parseInt($('#compPlannedQty' + i).val()))


            }
        }
        $("#lbl_PlnQtybol").text(sumOfPlannedQty);
        $("#lbl_ActQtybol").text(sumOfActualQty);
        //lbl_Compidbol2
        //lbl_CPlnQtybol2
        //lbl_CActQtybol2
    }
    function loadSlipPressed() {
        for (k = 1; k < 9; k++)
        {
            $('#lbl_Comp' + k).text(" ");
            $('#lbl_CompPQty' + k).text(" ");
        }

        var countTr = $('#compTable tr').length;
        var j = 0;
        for (var i = 0; i < countTr; i++) {
            if ($.isNumeric(parseInt($('#compPlannedQty' + i).val()))) {
                j++;
                $('#lbl_Comp' + j).text(parseInt($('#compCode' + i).val()))
                $('#lbl_CompPQty' + j).text(parseInt($('#compPlannedQty' + i).val()))


            }
        }

    }
    function closePressed() {
        //$("#shipmentStatusId").val(5);

        

    }
</script>





